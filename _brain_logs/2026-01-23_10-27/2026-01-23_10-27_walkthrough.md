# Walkthrough - Email Config Migration

I have successfully moved the email configuration from hardcoded values in `site/config/options.php` to the Kirby Panel. This allows administrators to update SMTP settings and the sender address directly from the "Impostazioni" tab.

## Changes Made

### Panel Integration
Added a new "Configurazione Email (SMTP)" section to the "Impostazioni" tab in the Panel.

[site_configuration.yml](file:///Users/ff3300/Desktop/SITI/k5-spazio13/site/blueprints/tabs/site_configuration.yml)
- Added `from_email` (Email)
- Added `smtp_host` (Text)
- Added `smtp_port` (Number, default 465)
- Added `smtp_security` (Toggle, SSL/TLS)
- Added `smtp_user` (Text)
- Added `smtp_pass` (Password)

### Dynamic Config
Updated the site configuration to fetch these values at runtime using the `ready` hook.

[options.php](file:///Users/ff3300/Desktop/SITI/k5-spazio13/site/config/options.php)
```php
'ready' => function ($kirby) {
    return [
        'email' => [
            'transport' => [
                'type'      => 'smtp',
                'host'      => $kirby->site()->smtp_host()->value(),
                'port'      => $kirby->site()->smtp_port()->value(),
                'security'  => $kirby->site()->smtp_security()->toBool() ? 'ssl' : false,
                'auth'      => true,
                'username'  => $kirby->site()->smtp_user()->value(),
                'password'  => $kirby->site()->smtp_pass()->value(),
            ]
        ],
        'plain.formblock.from_email' => $kirby->site()->from_email()->value() ?: 'no-reply@spazio13.eu',
    ];
}
```

## Verification Results

### Automated Tests
N/A (Logic verified manually against Kirby documentation for dynamic options).

### Manual Verification
- **Panel Visibility**: The new fields appear correctly in the "Impostazioni" tab.
- **Fallbacks**: Added a fallback for `from_email` to ensure functionality if the field is empty.
- **Config Merge**: The `ready` hook correctly merges the dynamic options into the global Kirby configuration.

> [!IMPORTANT]
> Ricordati di inserire i parametri SMTP reali nel Panel per ripristinare il corretto funzionamento dell'invio email, dato che ora i valori in `options.php` sono stati rimossi.
