# Walkthrough - Ruoli e Permessi Personalizzati

È stato implementato un sistema di permessi granulari per permettere agli amministratori di definire esattamente cosa ogni utente (con ruolo "Editor") può modificare nel Panel.

## Modifiche Principali

### 1. Nuovo Ruolo: Editor
È stato creato il blueprint [editor.yml](file:///Users/ff3300/Desktop/SITI/k5-base/site/blueprints/users/editor.yml) che definisce il ruolo "Editor".
- **Accesso Limitato**: Gli editor non possono accedere alle impostazioni di sistema, alle lingue o alla gestione utenti.
- **Campi Permessi**: Nel profilo dell'utente (visibile e modificabile solo dall'Admin), sono stati aggiunti due campi:
  - **Pagine Singole**: Per dare accesso a pagine specifiche (es. "Home").
  - **Collezioni**: Per dare accesso a un'intera sezione (es. "Progetti" e tutti i sottotitoli).

### 2. Plugin Logica Permessi
Il plugin [custom-permissions](file:///Users/ff3300/Desktop/SITI/k5-base/site/plugins/custom-permissions/index.php) gestisce la protezione in tempo reale tramite Hooks di Kirby.

- **Hook Intercettati**:
  - `page.update`: Impedisce il salvataggio se la pagina non è nelle liste permesse.
  - `page.create`: Impedisce la creazione se il genitore non è permesso.
  - `page.delete`: Impedisce l'eliminazione.
  - `page.changeStatus`: Impedisce la pubblicazione/bozza.
  - `page.changeSlug` e `page.changeTitle`: Protegge l'URL e il nome della pagina.
- **Sicurezza**: Un hook `user.update` impedisce a un editor di modificare i propri permessi (anche se trovasse il modo di vederli nel Panel).

## Come Testare

1.  **Crea un Utente**: Vai in Utenti e crea un nuovo utente con ruolo **Editor**.
2.  **Assegna Permessi**:
    - Seleziona una pagina singola (es. `Contatti`).
    - Seleziona una collezione (es. `Progetti`).
3.  **Verifica**:
    - Accedi come l'utente Editor.
    - Prova a modificare `Contatti` -> Dovrebbe funzionare.
    - Prova a creare un sottoprogetto dentro `Progetti` -> Dovrebbe funzionare.
    - Prova a modificare la `Home` -> Dovrebbe apparire un errore: *"Non hai i permessi per modificare questa pagina."*
